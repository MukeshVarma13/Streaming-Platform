Setting up **Nginx with RTMP and HLS** on **Ubuntu** allows you to stream live video content (e.g., from OBS Studio) using RTMP and deliver it to viewers using HLS (HTTP Live Streaming). Here's a complete guide:

---

## ‚úÖ Requirements

* Ubuntu 20.04 / 22.04 (works similarly)
* Root or sudo access
* Basic knowledge of terminal commands

---

## 1. üîß Install Dependencies

```bash
sudo apt update
sudo apt install -y build-essential libpcre3 libpcre3-dev libssl-dev zlib1g-dev git
```

---

## 2. ‚¨áÔ∏è Download Nginx and RTMP Module

```bash
cd /usr/local/src
wget http://nginx.org/download/nginx-1.25.3.tar.gz
tar -zxvf nginx-1.25.3.tar.gz

# Clone the nginx-rtmp-module
git clone https://github.com/arut/nginx-rtmp-module.git
```

---

## 3. ‚öôÔ∏è Compile and Install Nginx with RTMP

```bash
cd nginx-1.25.3
./configure --with-http_ssl_module --add-module=../nginx-rtmp-module
make
sudo make install
```

> Nginx will be installed to `/usr/local/nginx`.

---

## 4. ‚úçÔ∏è Configure Nginx for RTMP + HLS

Edit the config file:

```bash
sudo nano /usr/local/nginx/conf/nginx.conf
```

Replace it with the following basic HLS + RTMP setup:

```nginx
worker_processes  auto;
events {
    worker_connections  1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;

    sendfile        on;
    keepalive_timeout  65;

    server {
        listen 8080;

        location / {
            root /usr/local/nginx/html;
            index index.html;
        }

        # Serve HLS fragments
        location /hls {
            types {
                application/vnd.apple.mpegurl m3u8;
                video/mp2t ts;
            }
            root /tmp;
            add_header Cache-Control no-cache;
            add_header Access-Control-Allow-Origin *;
        }
    }
}

rtmp {
    server {
        listen 1935;
        chunk_size 4096;

        application live {
            live on;
            record off;

            # Enable HLS
            hls on;
            hls_path /tmp/hls;
            hls_fragment 3;
            hls_playlist_length 60;

            # Optional: disable client publishing to only allow local (OBS etc.)
            # allow publish 127.0.0.1;
            # deny publish all;
        }
    }
}
```

---

## 5. üß™ Test & Run Nginx

```bash
sudo /usr/local/nginx/sbin/nginx
```

To stop:

```bash
sudo /usr/local/nginx/sbin/nginx -s stop
```

To reload config:

```bash
sudo /usr/local/nginx/sbin/nginx -s reload
```

---

## 6. üé• Stream via OBS Studio (or other encoder)

* **Stream URL (RTMP Server)**: `rtmp://your_server_ip/live`
* **Stream Key**: anything (e.g. `test`)

OBS will push the stream to:
üëâ `rtmp://your_server_ip/live/test`

---

## 7. üì∫ Play the Stream (via HLS)

Open this URL in a video player like VLC or a web HLS player:

```
http://your_server_ip:8080/hls/test.m3u8
```

---

## ‚úÖ Optional: Set Up as a System Service

You can create a systemd service to run Nginx as a daemon.

Would you like help with that as well?




<!-- To chane the port on which the hls is running -->

To change the **HTTP port (8080)** used for serving HLS (or any web content) in your Nginx RTMP setup, you need to modify the **`listen` directive** in the **`http` block** of your `nginx.conf`.

---

## üîß Where to Change the HTTP Port

In your `nginx.conf`, find this section:

```nginx
http {
    server {
        listen 8080;

        location / {
            ...
        }

        location /hls {
            ...
        }
    }
}
```

### ‚úÖ Change:

```nginx
listen 8080;
```

### üîÅ To:

```nginx
listen 8000;  # or any port you want
```

---

## üí° After Updating

1. **If running Nginx directly (non-Docker):**

```bash
sudo /usr/local/nginx/sbin/nginx -s reload
```

2. **If using Docker:**

* Update `nginx.conf`
* Update your `docker-compose.yml` to match the new exposed port:

```yaml
ports:
  - "8000:80"  # Change host port from 8080 to 8000
```

* Then restart the container:

```bash
docker compose down
docker compose up -d
```

---

## üîé Then Access:

Your new HLS URL would be:

```
http://localhost:8000/hls/your_stream_key.m3u8
```

Let me know what port you want to switch to, and I can update the config for you.





If you want to **check which process or server is using a specific port number**, here‚Äôs how to do it on different systems:

---

## üîç Check by Port Number

### ‚úÖ **Linux / macOS**

#### 1. **Using `lsof`**

```bash
sudo lsof -i :<port>
```

**Example:**

```bash
sudo lsof -i :8080
```

#### 2. **Using `ss`**

```bash
sudo ss -ltnp 'sport = :<port>'
```

**Example:**

```bash
sudo ss -ltnp 'sport = :1935'
```

---

### ‚úÖ **Windows**

#### 1. **Using `netstat`**

```cmd
netstat -aon | findstr :<port>
```

**Example:**

```cmd
netstat -aon | findstr :8080
```

This gives you the **PID** (Process ID). To find the actual process:

```cmd
tasklist | findstr <PID>
```

---

### ‚úÖ **Docker (If Using Docker Ports)**

```bash
docker ps | grep <port>
```

Or:

```bash
docker container ls --format "table {{.ID}}\t{{.Image}}\t{{.Ports}}" | grep <port>
```

---

### üîÑ Example Output:

```bash
COMMAND
nginx    12345  ... TCP *:8080 (LISTEN)
```

Means:

* Port `8080` is used by `nginx`
* PID is `12345`

---

Let me know the port you want to check (`e.g. 1935, 8080`) and your OS, and I‚Äôll give you the exact command.









To **stop the service using port 8080 on Ubuntu**, follow these steps:

---

### üîç Step 1: Find the Process Using Port 8080

Run:

```bash
sudo lsof -i :8080
```

You‚Äôll get output like:

```
COMMAND   PID   USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
java     1234   user   123  TCP  *:8080 (LISTEN)
```

This tells you:

* The process is `java`
* The **PID (Process ID)** is `1234`

---

### üõë Step 2: Stop the Process

#### Option A: Kill the process by PID

```bash
sudo kill -9 1234
```

#### Option B: Kill by port (alternative using `fuser`)

```bash
sudo fuser -k 8080/tcp
```

---

### ‚úÖ Step 3: Confirm It‚Äôs Stopped

Check again:

```bash
sudo lsof -i :8080
```

If no output appears, the port is no longer in use.

---

Would you like to **free it permanently** from something like a systemd service (e.g., `nginx`, `spring-boot`, etc.)? Let me know and I‚Äôll help you disable it from auto-start.




To stop a process using **port 8080 on Windows**, follow these steps:

---

### üîç Step 1: Find the Process Using Port 8080

Open **Command Prompt** as Administrator and run:

```cmd
netstat -aon | findstr :8080
```

Example output:

```
  TCP    0.0.0.0:8080     0.0.0.0:0     LISTENING     12345
```

* **12345** is the **PID** (Process ID)

---

### üîé Step 2: Identify the Process (Optional)

```cmd
tasklist /FI "PID eq 12345"
```

---

### üõë Step 3: Kill the Process

Now stop the process using the PID:

```cmd
taskkill /PID 12345 /F
```

* `/F` = forcefully terminate

---

### ‚úÖ Step 4: Verify It's Gone

Run again to make sure it‚Äôs not listening:

```cmd
netstat -aon | findstr :8080
```

---

Let me know if the port is being used by a known service like **XAMPP, Tomcat, Spring Boot, Node, or IIS**, and I can guide you to stop it more cleanly.
